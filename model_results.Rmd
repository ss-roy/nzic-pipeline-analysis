---
title: "Modelling Results - Likelihood of Infrastructure Project Delivery "
author: "Sujith Roy"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
---
# Objective
To assess the feasibility of predicting the likelihood of infrastructure project delivery using data from the Pipeline dataset and easily accessible external sources.

# Overview
The Pipeline dataset contains information on 5,940 infrastructure projects, including project status, funding status, procurement methods, timelines, and geographic details (latitude, longitude).

# Approach
The brute force approach involved creating a weighting system to assign likelihoods based on project sector, region, funding source, and duration spent in specific phases. However, the dataset lacks crucial information, such as how long a project remains in specific statuses (e.g., "On hold," "In Development") or reasons behind the statuses. These factors would have made the modeling more straightforward.

While it is possible to manually extract status durations, there were insufficient data points to model the 'likelihood' of completion directly. Thus, we focused on an alternative approach—predicting total delay as a proxy for project delivery likelihood.

To support this, several features were engineered from the Pipeline data:
•	complete: Indicates whether the project is complete.
•	planned_duration: Planned project duration.
•	actual_duration: Actual duration of the project.
•	budget_min and budget_max: Estimated budget range.
•	funding_status_indicator: Whether the funding source is confirmed.
•	project_status_indicator: Indicates whether the project is "In planning."
•	total_delay: Calculated as the difference between the actual completion date and the estimated completion date for completed projects.

Predicting total delay allows us to estimate the likelihood of project delivery, with higher delays implying lower chances of on-time completion. The predicted delays were then scaled to a likelihood percentage (0-100%) for each project region and sector, normalizing the values to assess the probability of on-time delivery.

# Modelling Results
```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
```

# Prediction Outputs from  LM1
The output below shows a snapshot of predicted delay and likelihood of project delivery from linear model 1

```{r echo=FALSE, warning=FALSE}
results_lm1 <- read.csv("out/results_model_1.csv")

results_lm1 %>%
  select(PrimaryKey, ProjectName, ProjectRegion, predicted_delay, likelihood) %>%
  sample_n(4)

```


# Prediction Outputs from  LM2
The output below shows a snapshot of predicted delay and likelihood of project delivery from linear model 2

```{r echo=FALSE}


results_lm2 <- read.csv("out/results_model_2.csv")

results_lm2 %>%
  select(ProjectName, ProjectRegion, EstimatedQuarterProjectRangeCompletion,predicted_delay, likelihood,ProjectStatus) %>%
  sample_n(4)



```


```{r include=FALSE, paged.print=FALSE}
source("source/3_linear_model.R")

```

# LM1 1: Plot 1 - Predicted Delay Faceted by Region and Sector
This graph below shows the distribution of expected delays across regions for the planned projects.
The fit for LM1 was not strong enough to use in production or for decision-making.  

```{r echo=FALSE, fig.height=12, fig.width=16, warning=FALSE}
# Plot 1: Predicted Delay Faceted by Region and Sector
p1_lm1 <- ggplot(results_model1, aes(x = ProjectRegion, y = predicted_delay, fill = CommissionAssignedInfrastructureSector)) +
  geom_boxplot(outlier.colour = "red", outlier.shape = 16, outlier.size = 2) +  # Boxplot to show distribution of predicted delay
  facet_wrap(~ CommissionAssignedInfrastructureSector, scales = "free_y") +  # Create facets by sector
  labs(title = "Predicted Delay by Project Region and Sector",
       x = "Project Region",
       y = "Predicted Delay") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))  # Rotate x-axis text for better readability
# ggsave("out/plots/13_lm1_predicted_delay.png", plot = p1_lm1, width = 16, height = 12)
p1_lm1
```

# LM1 1: Plot 2 -  Pedicted Likelihood Faceted by Region and Sector
The graph below shows the distribution of likelihood project delivery across regions for the planned projects. The likelihood distribution is all over the place failing to account for extreme cases.

```{r echo=FALSE, fig.height=12, fig.width=16, warning=FALSE}
# Plot 2: Likelihood Faceted by Region and Sector
p2_lm1 <- ggplot(results_model1, aes(x = ProjectRegion, y = likelihood, fill = CommissionAssignedInfrastructureSector)) +
  geom_boxplot(outlier.colour = "red", outlier.shape = 16, outlier.size = 2) +  # Boxplot for likelihood
  facet_wrap(~ CommissionAssignedInfrastructureSector, scales = "free_y") +  # Create facets by sector
  labs(title = "Likelihood of Project Completion by Project Region and Sector",
       x = "Project Region",
       y = "Likelihood (%)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
p2_lm1
```


```{r warning=FALSE, include=FALSE}
source("source/4_linear_model_macro.R")
```

# LM2 1: Plot 1 - Predicted Delay for Transport Sector by Region
This graph below shows the distribution of expected delays across regions for the planned projects in Transport sector.
The fit for LM2 was better than LM1 enough to use in production or for decision-making.  

```{r echo=FALSE, fig.height=12, fig.width=16, warning=FALSE}
p1_violin_lm2 <- ggplot(results_model2, aes(x = ProjectRegion, y = predicted_delay, fill = CommissionAssignedInfrastructureSector)) +
  geom_violin(trim = TRUE, alpha = 0.6) +  # Violin plot for predicted delay
  facet_wrap(~ CommissionAssignedInfrastructureSector, scales = "free_y") + 
  labs(title = "Predicted Delay by Project Region and Sector",
       x = "Project Region",
       y = "Predicted Delay") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
p1_violin_lm2
```


# LM2 1: Plot 2 - Predicted Likelihood of Project Delivery for Transport Sector by Region
The graph below shows the distribution of likelihood project delivery for the planned projects in Transport Sector. 

```{r echo=FALSE, fig.height=12, fig.width=16, warning=FALSE}
p2_violin_lm2 <- ggplot(results_model2, aes(x = ProjectRegion, y = likelihood, fill = CommissionAssignedInfrastructureSector)) +
  geom_violin(trim = TRUE, alpha = 0.6) +  # Violin plot for likelihood
  facet_wrap(~ CommissionAssignedInfrastructureSector, scales = "free_y") + 
  labs(title = "Likelihood of Project Completion by Project Region and Sector",
       x = "Project Region",
       y = "Likelihood (%)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
p2_violin_lm2
```
# Final Model LM2 Diagnostics


# Model Summary

Final input variables are average delay in the sector, minimum budget, maximum budget, planned duration, funding status (confirmed or not), project status, Project Region, GDP Delta and CPI Delta
Model has an accuracy of ~80%

```{r echo=TRUE}
summary(delay_model_2)
```


# Residuals
Residuals Histogram to check normality of residuals. 
```{r echo=FALSE}
# Residuals Histogram to check normality of residuals
ggplot(data.frame(residuals = residuals(delay_model_2)), aes(x = residuals)) +
  geom_histogram(bins = 30, fill = "blue", alpha = 0.7) +
  labs(title = "Histogram of Residuals",
       x = "Residuals",
       y = "Frequency") +
  theme_minimal()
```


# Residuals vs actuals

```{r echo=FALSE}
# Residuals vs Fitted Values Plot
p1 <- ggplot(completed_projects, aes(x = fitted(delay_model_2), y = residuals(delay_model_2))) +
  geom_point(alpha = 0.7) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(title = "Residuals vs. Fitted Values",
       x = "Fitted Values",
       y = "Residuals") +
  theme_minimal()
p1
```
